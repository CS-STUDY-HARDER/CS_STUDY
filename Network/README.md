# TCP/IP

---

## IP 주소와 서브넷 마스크 그리고 기본 게이트웨이의 의미

![ipconfig 결과](images/ipconfig.png "ipconfig 결과")

- 이더넷 어뎁터

PC에서 사용하는 LAN 카드, LAN 카드를 NIC(Network Interface Controller)라고도 한다. 이더넷이란 LAN 영역에서 사용하는 통신 기술 중 사실상 표준이다.

- IP 주소

인터넷 공간에서 PC가 사용하는 고유한 식별자이다. IP 주소는 데이터를 송신하는 주체이기 때문에 출발지 주소이다.  127.0.0.1번은 자기의 LAN 카드 자신을 의미하는 루프백 주소이다.

- 서브넷 마스크

IP 주소와 쌍으로 사용하는 개념이다. 192.168.35.176 255.255.255.0 등과 같이 사용한다. IP 주소를 서브넷 마스크를 이용해 표기하는 방식을 서브넷 마스크 표기법이라고 부른다. 위 예에서 192.168.35은 255.255.255에 대응하고 176은 0에 대응한다. 이때 255.255.255번에 대응하는 192.168.0을 네트워크 ID라고 부르고, 13번을 호스트 ID라고 부른다.

- 기본 게이트웨이

게이트웨이를 다른 말로 라우터라고 한다. 게이트웨이는 무선 공유기를 의미하고, 무선 공유기에서 사용하는 IP 주소가 192.168.35.1이다. 라우터는 인터넷 공간에서 각기 다른 호스트 사이를 연결해주는 라우팅을 수행한다.


---

## DHCP 서비스와 DNS 서비스 그리고 물리적 주소의 의미

![ipconfig-all](images/ipconfig-all.png "ipconfig/all")

- DHCP 사용 : PC에서 IP 주소를 유동 IP 방식으로 사용
    - IP 주소는 원래 사용자가 IP 주소와 서브넷 마스크, 기본 게이트웨이 등을 직접 입력해야 하지만 쉽지 않다. DHCP 서비스는 사용할 IP 주소 범위를 서버에 미리 등록하면 PC 사용자에게 IP 주소와 서브넷 마스크, 게이트웨이 IP 주소, DNS 서버 IP 주소를 자동으로 할당해준다.
    - 가정에서 인터넷을 사용하는 초고속 인터넷 가입자는 DHCP 서비스 방식을 이용한다.


- ‘임대 시작 날짜’와 ‘임대 만료 날짜’가 있는데 DHCP 방식에 따라 IP 주소를 할당받은 시간과 IP 주소를 사용한 시간이고 동시에 PC 사용 시간을 의미한다.


- ‘기본 게이트웨이’와 ‘DHCP 서버’의 IP 주소가 같은데 게이트웨이에서 DHCP 기능을 수행한다는 것이다. 다시 말해, 무선 공유기는 게이트웨이 역할과 DHCP 서버 기능도 수행한다.


- DNS 서버 : 두 IP 주소가 보이는데 IPS에서 제공하는 DNS 서버 IP 주소다.
    - DNS 서버는 사용자가 입력한 도메인 네임을 IP 주소로 변환한다.
    - 도메인 네임과 IP 주소의 대응관계를 일종의 DB 형태로 저장해 사용하는 기능이 DNS 서비스


- 물리적 주소: 맥(MAC) 주소라고도 하며 이더넷 어댑터 로컬 영역 연결 부분과 관련이 있다.
    - 맥 주소는 LAN 영역에서 내부 통신을 수행하기 위해 필요한 주소이다.
    - 출발지에서 스위치 장비를 통해 목적지로 이동하고, 이 때 스위치 장비의 내장 테이블에 맥 주소를 저장 및 검색하는데 이 과정을 스위칭이라고 한다.
    - 스위치는 맥 주소 인식을 통해 목적지 맥 주소가 있는 해당 포트로만 데이터를 전송하는데, 이를 포워딩이라고 한다.

---

## ARP 캐시 테이블

![ping](images/ping.png "ping")

ping 명령어는 출발지 호스트와 목적지 호스트 사이에서 회선의 연결 상태나 목적지 운영체제의 동작 여부 등을 점검하기 위한 도구이다.

![arp -a](images/arp-a.png "arp -a")

라우터가 사용하는 192.168.35.1번 IP 주소와 08-5d-dd-f6-9c-01 맥 주소가 대응 관계를 이루고 있다. IP 주소와 맥 주소의 대응 관계를 저장한 테이블을 ARP 캐시 테이블이라고 한다.

| 구분 | 출발지 | 목적지 |
| --- | --- | --- |
| IP 주소 | 192.168.0.13 | 8.8.8.8 |
| MAC 주소 | 00-24-1D-DF-8c-47 |  |

운영체제는 자기의 서브넷 마스크를 가지고 출발지 IP 주소와 목적지 IP 주소를 설정한 뒤 출발지 네트워크 ID와 목적지 네트워크 ID를 비교한다. 출발지와 다른 LAN 영역에 목적지로 데이터를 전송하기 위해 운영체제는 자기의 라우터 IP 주소를 목적지 IP 주소로 변경한다.

| 구분 | 출발지 | 목적지 |
| --- | --- | --- |
| IP 주소 | 192.168.0.13 | 192.168.0.1 |
| MAC 주소 | 00-24-1D-DF-8c-47 |  |

이제 기본 게이트웨이에 해당하는 목적지 맥 주소를 알아야한다. 자기가 속한 LAN 영역 전체를 대상으로 192.168.0.1번에 대응하는 맥 주소를 구하기 위해 ARP 질의를 브로드캐스트 방식으로 전송한다.

LAN 영역의 호스트 중 192.168.0.1번을 사용하는 게이트웨이가 맥 주소를 유니캐스트 방식으로 전송한다.

| 구분 | 출발지 | 목적지 |
| --- | --- | --- |
| IP 주소 | 192.168.0.13 | 192.168.0.1 |
| MAC 주소 | 00-24-1D-DF-8c-47 | 00-26-66-86-f8 |

이처럼 목적지 맥 주소가 저장되면 운영체제에서 ARP 캐시 테이블을 참조해 데이터를 유니캐스트 방식으로 게이트웨이에 전송한다. 이후부터 게이트웨이 IP 주소에 기반한 라우팅 통신을 통해 전송한다.

---

## UDP 방식과 TCP 방식

UDP 방식은 송신 측 호스트에서 송신 데이터가 생기면 곧바로 수신 측 호스트에게 전송을 수행한다. 수신 여부는 고려하지 않고, 전송 중 오류가 생기는 것도 고려하지 않는다.

TCP는 다음과 같이 동작한다.

- TCP는 송신 데이터가 생기면 수신 측 호스트에게 SYN 신호를 보내 동기화를 요청하고 수신 가능 여부를 확인한다.
- 수신측에서 SYN/ACK 신호로 응답을 보낸다. ACK는 송신 요청에 대해 수락을 의미하고, SYN은 수신 측에서 역으로 송신 측에게 동기화를 요청한다.
- 송신 측은 SYN/ACK 신호를 받으면 다시 ACK 신호를 전송한다.

![tcp-3way](images/tcp-3way.png "tcp 3 way")

이 3단계 동기화 과정을 마친 뒤 실제 데이터를 주고 받는다.  이 과정은 데이터 전송 과정과 종료에서도 같은 형식을 취한다.

| 단계 | 동작 방식 | 사용 신호 |
| --- | --- | --- |
| 전송 전 | 3단계 열정 설정 수행 | SYN, ACK |
| 전송 중 | 전송 후 응답 신호 수신 대기 | PUSH, ACK |
| 전송 후 | 3/4 단계 연결 종료 수행 | FIN, ACK |

TCP 방식이 3단계 연결 설정과 3/4단계 연결 종료를 수행할 수 있는 이유는 버퍼링 때문이다. UDP 방식은 버퍼링 기능이 없어서 일방적인 전송만을 수행한다. 반면 TCP 방식은 버퍼링 기능이 있어 송신자와 수신자 사이에 상호작용이 가능하다.

---